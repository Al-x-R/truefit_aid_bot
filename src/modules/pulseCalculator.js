// src/modules/pulseCalculator.js

/**
 * Рассчитывает пульсовые зоны на основе возраста.
 * Использует формулу максимального пульса: 220 - возраст.
 *
 * @param {number} age - Возраст пользователя.
 * @returns {string} Отформатированный текст с описанием пульсовых зон.
 */
function calculatePulseZones(age) {
  if (typeof age !== 'number' || age <= 0) {
    return 'Пожалуйста, введите корректный возраст (положительное число).';
  }

  const maxHR = 220 - age; // Формула 220 - возраст

  // Определение пульсовых зон
  const zones = [
    { name: 'Зона Здоровья / Восстановления', range: [0.50, 0.60], purpose: 'Легкие нагрузки, разминка, заминка, улучшение кровообращения.' },
    { name: 'Зона Сжигания Жира', range: [0.60, 0.70], purpose: 'Эффективное жиросжигание, повышение общей выносливости.' },
    { name: 'Аэробная Зона', range: [0.70, 0.80], purpose: 'Развитие кардиоваскулярной системы, улучшение выносливости.' },
    { name: 'Анаэробная Зона', range: [0.80, 0.90], purpose: 'Развитие скорости и анаэробной выносливости, интервальные тренировки.' },
    { name: 'Красная Зона (Максимальная)', range: [0.90, 1.00], purpose: 'Максимальные усилия, очень короткие интервалы, только для подготовленных.' }
  ];

  let resultText = `*Расчет пульсовых зон для возраста ${age} лет:*\n\n`;
  resultText += `Ваш примерный максимальный пульс (MaxHR), рассчитанный *по формуле Фокса, Хаскелла и Девиса* (220 - возраст), составляет: *${maxHR} ударов/мин*.\n\n`;
  resultText += `---Ваши пульсовые зоны---\n`;

  zones.forEach(zone => {
    const minPulse = Math.round(maxHR * zone.range[0]);
    const maxPulse = Math.round(maxHR * zone.range[1]);
    resultText += `\n*${zone.name} (${Math.round(zone.range[0]*100)}-${Math.round(zone.range[1]*100)}% MaxHR)*\n`;
    resultText += `Диапазон пульса: *${minPulse}-${maxPulse} ударов/мин*\n`;
    resultText += `Назначение: _${zone.purpose}_\n`;
  });

  resultText += '\n_Примечание: Это расчет по стандартной формуле. Ваш индивидуальный MaxHR может отличаться._';
  resultText += '\n\n*Хотите узнать больше о тренировках по пульсовым зонам?* Читайте нашу статью: [Ссылка на статью о пульсовых зонах в Telegraph]'; // placeholder

  return resultText;
}

module.exports = {
  calculatePulseZones
};
